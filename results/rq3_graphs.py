from scipy.stats import bootstrap
import matplotlib.pyplot as plt
from matplotlib.patches import Patch
from scipy.stats import wilcoxon
import pandas as pd
import numpy as np
import seaborn as sns

def sr_ci(rewards, k, threshold=0.95, ci=0.95, n_resamples=9_999, rng_seed=42):
    global_max = rewards.max(axis=1, keepdims=True)
    hit = (rewards[:, :k] >= threshold * global_max).any(axis=1).astype(float)
    res = bootstrap((hit,), np.mean, n_resamples=n_resamples,
                    confidence_level=ci, random_state=rng_seed, method='percentile')
    return {
        'mean': hit.mean(),
        'ci_low': res.confidence_interval.low,
        'ci_high': res.confidence_interval.high
    }

def gpc(rewards, k, threshold=0.95):
    global_max = rewards.max(axis=1, keepdims=True)
    return (rewards[:, :k] >= threshold * global_max).sum(axis=1)

def get_best_performance(array):
    return np.max(array, axis=1)  # Max performance per run

def trials_to_95_percent(array, i):
    # Best performance for the method: max across all runs and trials
    best_perf = np.max(array)

    trials_list = []
    for run in array:
        # Find the first trial (1-based) where performance >= 0.95 * best
        reached = np.where(run >= 0.95 * best_perf)[0]
        if len(reached) > 0:
            trials = reached[0] + 1  # 1-based index
        else:
            trials = len(run)  # If never reached, set to max trials + 1
        trials_list.append(trials)

    return np.array(trials_list)

bo_10_sp = np.array([[0.781, 0.768, 0.785, 0.776, 0.7849999999999999, 0.779, 0.776, 0.779, 0.7710000000000001, 0.78], [0.777, 0.772, 0.7849999999999999, 0.776, 0.784, 0.766, 0.795, 0.778, 0.779, 0.7689999999999999], [0.767, 0.773, 0.762, 0.771, 0.78, 0.779, 0.783, 0.774, 0.774, 0.779], [0.783, 0.795, 0.787, 0.7700000000000001, 0.787, 0.7709999999999999, 0.7869999999999999, 0.78, 0.7699999999999999, 0.792], [0.764, 0.7889999999999999, 0.788, 0.7729999999999999, 0.782, 0.7830000000000001, 0.764, 0.7759999999999999, 0.775, 0.7750000000000001]])

bo_10_cm = np.array([[0.0, 0.18, 0.538, 0.0, 1.0219999999999998, 0.5345, 0.0, 0.34750000000000003, 0.0, 0.0215], [0.176, 0.0, 0.861, 0.868, 0.6825, 0.8350000000000002, 0.5029999999999999, 0.0, 0.0, 0.341], [1.704, 1.0394999999999999, 0.3445, 0.0, 0.38649999999999995, 1.0219999999999998, 0.0, 0.014499999999999999, 1.7035, 1.6915], [0.337, 0.8684999999999998, 0.0, 0.0, 0.0, 0.0, 1.7570000000000001, 0.0, 0.0, 0.4995], [0.0, 0.8664999999999999, 1.1444999999999999, 1.7100000000000002, 0.7304999999999999, 1.3495, 0.178, 0.193, 0.0, 0.0]])

rs_10_sp = np.array([[0.781, 0.768, 0.785, 0.776, 0.7849999999999999, 0.779, 0.776, 0.779, 0.7710000000000001, 0.78], [0.777, 0.772, 0.7849999999999999, 0.776, 0.784, 0.766, 0.795, 0.778, 0.779, 0.7689999999999999], [0.767, 0.773, 0.762, 0.771, 0.78, 0.779, 0.783, 0.774, 0.774, 0.779], [0.783, 0.795, 0.787, 0.7700000000000001, 0.787, 0.7709999999999999, 0.7869999999999999, 0.78, 0.7699999999999999, 0.792], [0.764, 0.7889999999999999, 0.788, 0.7729999999999999, 0.782, 0.7830000000000001, 0.764, 0.7759999999999999, 0.775, 0.7750000000000001]])

rs_10_cm = np.array([[0.0, 0.18, 0.538, 0.0, 1.0219999999999998, 0.5345, 0.0, 0.34750000000000003, 0.0, 0.0215], [0.176, 0.0, 0.861, 0.868, 0.6825, 0.8350000000000002, 0.5029999999999999, 0.0, 0.0, 0.341], [1.704, 1.0394999999999999, 0.3445, 0.0, 0.38649999999999995, 1.0219999999999998, 0.0, 0.014499999999999999, 1.7035, 1.6915], [0.337, 0.8684999999999998, 0.0, 0.0, 0.0, 0.0, 1.7570000000000001, 0.0, 0.0, 0.4995], [0.0, 0.8664999999999999, 1.1444999999999999, 1.7100000000000002, 0.7304999999999999, 1.3495, 0.178, 0.193, 0.0, 0.0]])

dqn_10_cm = np.array([[1.702, 0.0, 1.682, 1.76, 1.717, 1.363, 1.717, 1.717, 1.717, 1.717], [0.34, 0.0, 1.696, 1.531, 1.288, 1.558, 1.676, 1.558, 1.558, 1.549], [0.181, 0.0, 1.532, 0.368, 1.697, 1.712, 0.37, 1.697, 1.686, 1.697], [1.637, 0.0, 1.71, 1.587, 1.34, 1.587, 1.728, 1.062, 1.587, 1.587], [1.214, 1.705, 0.869, 1.216, 1.686, 1.707, 0.0, 1.71, 1.707, 1.707]])

dqn_10_sp = np.array([[0.782, 0.774, 0.776, 0.782, 0.778, 0.787, 0.778, 0.778, 0.778, 0.782], [0.769, 0.772, 0.76, 0.771, 0.781, 0.781, 0.785, 0.781, 0.781, 0.771], [0.767, 0.772, 0.764, 0.784, 0.776, 0.767, 0.776, 0.776, 0.789, 0.791], [0.786, 0.773, 0.775, 0.775, 0.782, 0.775, 0.77, 0.773, 0.775, 0.775], [0.771, 0.776, 0.77, 0.774, 0.792, 0.784, 0.774, 0.774, 0.784, 0.784]])

rs_50_sp = np.array([[0.781, 0.768, 0.785, 0.776, 0.7849999999999999, 0.779, 0.776, 0.779, 0.7710000000000001, 0.78, 0.787, 0.7790000000000001, 0.781, 0.784, 0.767, 0.775, 0.7869999999999999, 0.781, 0.772, 0.787, 0.765, 0.788, 0.768, 0.775, 0.7889999999999999, 0.783, 0.782, 0.769, 0.776, 0.7780000000000001, 0.7700000000000001, 0.7649999999999999, 0.781, 0.7849999999999999, 0.8, 0.7799999999999999, 0.7790000000000001, 0.7809999999999999, 0.7779999999999999, 0.7879999999999999, 0.779, 0.7769999999999999, 0.782, 0.783, 0.761, 0.778, 0.782, 0.7830000000000001, 0.772, 0.776], [0.777, 0.772, 0.7849999999999999, 0.776, 0.784, 0.766, 0.795, 0.778, 0.779, 0.7689999999999999, 0.7949999999999999, 0.781, 0.779, 0.772, 0.7710000000000001, 0.79, 0.7769999999999999, 0.7849999999999999, 0.7899999999999999, 0.7779999999999999, 0.7849999999999999, 0.793, 0.783, 0.79, 0.788, 0.784, 0.7949999999999999, 0.78, 0.777, 0.798, 0.781, 0.768, 0.775, 0.787, 0.782, 0.794, 0.776, 0.7729999999999999, 0.782, 0.786, 0.7859999999999999, 0.784, 0.767, 0.786, 0.7889999999999999, 0.791, 0.785, 0.7699999999999999, 0.7790000000000001, 0.769], [0.767, 0.773, 0.762, 0.771, 0.78, 0.779, 0.783, 0.774, 0.774, 0.779, 0.773, 0.78, 0.7949999999999999, 0.776, 0.775, 0.788, 0.8020000000000002, 0.7790000000000001, 0.7859999999999999, 0.783, 0.775, 0.7949999999999999, 0.792, 0.761, 0.778, 0.7869999999999999, 0.78, 0.7699999999999999, 0.782, 0.771, 0.789, 0.779, 0.7770000000000001, 0.786, 0.778, 0.772, 0.775, 0.792, 0.7699999999999999, 0.79, 0.7949999999999999, 0.7750000000000001, 0.78, 0.777, 0.784, 0.7870000000000001, 0.7780000000000001, 0.7849999999999999, 0.768, 0.784], [0.783, 0.795, 0.787, 0.7700000000000001, 0.787, 0.7709999999999999, 0.7869999999999999, 0.78, 0.7699999999999999, 0.792, 0.7729999999999999, 0.793, 0.783, 0.784, 0.7929999999999999, 0.794, 0.7889999999999999, 0.781, 0.796, 0.7789999999999999, 0.773, 0.783, 0.7789999999999999, 0.782, 0.786, 0.788, 0.783, 0.7710000000000001, 0.772, 0.7779999999999999, 0.771, 0.779, 0.7859999999999999, 0.772, 0.7790000000000001, 0.7809999999999999, 0.792, 0.799, 0.777, 0.77, 0.785, 0.768, 0.79, 0.7770000000000001, 0.783, 0.776, 0.7789999999999999, 0.775, 0.7859999999999999, 0.783], [0.764, 0.7889999999999999, 0.788, 0.7729999999999999, 0.782, 0.7830000000000001, 0.764, 0.7759999999999999, 0.775, 0.7750000000000001, 0.796, 0.784, 0.782, 0.777, 0.788, 0.7939999999999999, 0.773, 0.78, 0.764, 0.778, 0.783, 0.768, 0.7749999999999999, 0.7889999999999999, 0.791, 0.792, 0.7689999999999999, 0.799, 0.788, 0.7710000000000001, 0.778, 0.775, 0.764, 0.774, 0.7889999999999999, 0.786, 0.7849999999999999, 0.784, 0.7749999999999999, 0.7869999999999999, 0.779, 0.768, 0.766, 0.7689999999999999, 0.775, 0.7819999999999999, 0.786, 0.7689999999999999, 0.7670000000000001, 0.7859999999999999]])

rs_50_cm = np.array([[0.0, 0.18, 0.538, 0.0, 1.0219999999999998, 0.5345, 0.0, 0.34750000000000003, 0.0, 0.0215, 0.556, 0.1815, 0.181, 0.1825, 1.177, 0.542, 0.7005000000000001, 0.0, 0.6305, 0.2805, 0.869, 1.7515, 0.0, 1.691, 0.0, 0.708, 1.704, 1.0190000000000001, 1.3815, 1.042, 0.6725, 1.5455, 1.1880000000000002, 1.7055, 1.765, 1.0325, 0.202, 1.748, 1.7269999999999999, 1.425, 0.6955, 0.0, 1.3649999999999998, 1.7564999999999997, 0.0, 0.302, 0.014000000000000002, 1.1905000000000001, 1.6925000000000001, 1.746], [0.176, 0.0, 0.861, 0.868, 0.6825, 0.8350000000000002, 0.5029999999999999, 0.0, 0.0, 0.341, 0.3245, 0.19, 0.8724999999999999, 0.0, 0.526, 0.0, 0.8665, 1.042, 0.507, 0.0, 0.3445, 0.311, 0.0, 1.1545, 1.7335, 0.0, 1.0585, 1.701, 1.685, 0.693, 0.18, 0.8400000000000001, 0.0, 0.185, 0.33849999999999997, 1.7085000000000001, 0.193, 0.7394999999999999, 1.5405, 0.0, 0.683, 1.2125, 0.0, 0.0, 0.341, 0.148, 0.1605, 1.2245000000000001, 0.8220000000000001, 0.0], [1.704, 1.0394999999999999, 0.3445, 0.0, 0.38649999999999995, 1.0219999999999998, 0.0, 0.014499999999999999, 1.7035, 1.6915, 1.6560000000000001, 1.539, 0.36849999999999994, 1.3545, 0.8685, 1.3989999999999998, 0.47300000000000003, 0.7155, 0.3215, 0.37, 0.666, 1.6785, 0.7135, 0.522, 0.396, 1.704, 0.1775, 1.703, 1.6575, 0.0, 0.7064999999999999, 1.1804999999999999, 0.8495000000000001, 1.7265000000000001, 0.6485, 1.036, 1.4224999999999999, 0.5115000000000001, 1.6925000000000001, 1.572, 1.7269999999999999, 1.036, 1.0370000000000001, 0.851, 1.7325, 1.7169999999999999, 0.517, 1.2285, 0.525, 0.6795], [0.337, 0.8684999999999998, 0.0, 0.0, 0.0, 0.0, 1.7570000000000001, 0.0, 0.0, 0.4995, 0.351, 1.5485000000000002, 0.184, 1.0745, 0.0, 0.0, 0.1665, 1.6460000000000001, 0.8574999999999999, 1.2040000000000002, 1.0495, 0.8655000000000002, 0.346, 1.35, 0.563, 1.362, 1.6585, 0.858, 0.1665, 0.182, 0.17450000000000002, 0.867, 0.5645, 0.0, 1.519, 0.4885, 0.49799999999999994, 1.7145, 0.0, 0.6945, 0.191, 0.02, 0.755, 1.3405, 0.425, 1.21, 0.354, 0.1975, 1.076, 1.672], [0.0, 0.8664999999999999, 1.1444999999999999, 1.7100000000000002, 0.7304999999999999, 1.3495, 0.178, 0.193, 0.0, 0.0, 0.0, 0.0195, 1.025, 1.154, 0.9885000000000002, 0.0, 1.7065000000000001, 0.549, 0.8685, 0.5395000000000001, 1.202, 1.3684999999999998, 0.7295, 1.3795, 0.193, 1.0565000000000002, 1.536, 1.187, 1.5439999999999998, 1.0390000000000001, 0.49450000000000005, 0.0, 0.1685, 1.6934999999999998, 1.3835, 0.35150000000000003, 0.0, 0.0, 0.52, 0.0, 0.0, 0.33999999999999997, 0.0, 0.3075, 0.292, 1.7045, 0.0405, 1.1504999999999999, 0.6965, 0.5395]])

rs_50_sm = np.array([[0.4, 0.6, 0.2, 0.4, 0.8, 0.4, 0.2, 0.0, 0.0, 0.8, 0.4, 1.0, 0.0, 0.0, 0.8, 0.2, 0.6, 0.0, 0.2, 0.8, 0.4, 1.0, 0.8, 0.0, 1.0, 0.8, 1.0, 0.2, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.6, 0.6, 1.0, 0.8, 0.6, 0.8, 0.0, 1.0, 1.0, 0.0, 0.8, 0.0, 0.8, 1.0, 1.0], [0.6, 0.0, 0.0, 0.0, 0.6, 0.6, 0.0, 0.0, 1.0, 0.0, 0.0, 0.8, 0.6, 0.0, 0.0, 0.0, 0.8, 1.0, 0.0, 0.0, 0.4, 0.4, 0.0, 0.8, 0.8, 0.0, 0.0, 1.0, 1.0, 0.2, 0.0, 1.0, 0.0, 0.6, 0.6, 1.0, 0.0, 1.0, 0.8, 0.6, 0.4, 1.0, 0.4, 0.2, 0.4, 0.0, 0.8, 1.0, 0.6, 0.0], [1.0, 0.8, 1.0, 0.0, 0.8, 0.6, 0.0, 0.0, 0.8, 1.0, 1.0, 1.0, 0.0, 0.2, 0.2, 0.8, 0.6, 1.0, 0.6, 0.0, 0.4, 0.8, 0.8, 0.4, 0.8, 1.0, 0.6, 1.0, 0.6, 0.0, 0.2, 1.0, 0.6, 1.0, 1.0, 1.0, 0.4, 0.4, 1.0, 1.0, 1.0, 0.8, 0.6, 0.8, 1.0, 0.6, 0.4, 0.0, 0.4, 0.0], [0.6, 0.8, 0.2, 0.0, 0.0, 0.0, 1.0, 0.8, 0.0, 0.2, 0.4, 1.0, 0.4, 0.6, 0.4, 0.4, 0.0, 1.0, 0.4, 0.8, 0.8, 0.6, 0.2, 1.0, 0.4, 0.0, 1.0, 1.0, 0.4, 0.4, 0.6, 0.6, 0.8, 0.0, 0.8, 0.6, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.2, 1.0, 0.0, 0.8, 0.0, 0.0, 0.6, 1.0], [0.2, 0.8, 1.0, 1.0, 0.4, 1.0, 0.0, 0.0, 0.0, 0.0, 0.6, 0.2, 0.0, 1.0, 0.8, 0.4, 1.0, 0.2, 0.8, 0.6, 1.0, 1.0, 0.6, 1.0, 1.0, 1.0, 1.0, 1.0, 0.8, 1.0, 0.6, 1.0, 0.2, 1.0, 1.0, 0.2, 0.6, 0.0, 0.0, 0.4, 0.0, 1.0, 0.4, 0.6, 0.0, 1.0, 0.6, 0.8, 0.8, 0.6]])

bo_50_sp = np.array([[0.781, 0.768, 0.785, 0.776, 0.7849999999999999, 0.779, 0.776, 0.779, 0.7710000000000001, 0.78, 0.772, 0.7799999999999999, 0.7879999999999999, 0.7849999999999999, 0.772, 0.772, 0.761, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791, 0.791], [0.777, 0.772, 0.7849999999999999, 0.776, 0.784, 0.766, 0.795, 0.778, 0.779, 0.7689999999999999, 0.772, 0.774, 0.7949999999999999, 0.772, 0.791, 0.772, 0.784, 0.7899999999999999, 0.792, 0.7809999999999999, 0.7859999999999999, 0.7809999999999999, 0.7899999999999999, 0.7899999999999999, 0.772, 0.784, 0.7869999999999999, 0.78, 0.775, 0.792, 0.782, 0.783, 0.792, 0.792, 0.792, 0.7769999999999999, 0.791, 0.772, 0.796, 0.7929999999999999, 0.772, 0.7929999999999999, 0.791, 0.7780000000000001, 0.776, 0.791, 0.788, 0.792, 0.784, 0.791], [0.767, 0.773, 0.762, 0.771, 0.78, 0.779, 0.783, 0.774, 0.774, 0.779, 0.786, 0.7749999999999999, 0.7879999999999999, 0.772, 0.787, 0.7690000000000001, 0.772, 0.782, 0.7689999999999999, 0.791, 0.791, 0.791, 0.791, 0.791, 0.794, 0.793, 0.793, 0.793, 0.772, 0.795, 0.795, 0.794, 0.795, 0.795, 0.795, 0.795, 0.7819999999999999, 0.795, 0.795, 0.795, 0.795, 0.794, 0.772, 0.772, 0.785, 0.787, 0.788, 0.785, 0.783, 0.791], [0.783, 0.795, 0.787, 0.7700000000000001, 0.787, 0.7709999999999999, 0.7869999999999999, 0.78, 0.7699999999999999, 0.792, 0.772, 0.782, 0.7969999999999999, 0.772, 0.772, 0.7789999999999999, 0.7789999999999999, 0.776, 0.772, 0.772, 0.7849999999999999, 0.784, 0.7750000000000001, 0.772, 0.788, 0.789, 0.789, 0.789, 0.7809999999999999, 0.782, 0.7849999999999999, 0.772, 0.78, 0.7870000000000001, 0.764, 0.78, 0.784, 0.784, 0.784, 0.7830000000000001, 0.779, 0.781, 0.783, 0.772, 0.776, 0.794, 0.7819999999999999, 0.781, 0.772, 0.796], [0.764, 0.7889999999999999, 0.788, 0.7729999999999999, 0.782, 0.7830000000000001, 0.764, 0.7759999999999999, 0.775, 0.7750000000000001, 0.7870000000000001, 0.78, 0.7769999999999999, 0.782, 0.779, 0.772, 0.776, 0.784, 0.772, 0.788, 0.7949999999999999, 0.772, 0.787, 0.778, 0.7750000000000001, 0.772, 0.7809999999999999, 0.785, 0.786, 0.791, 0.792, 0.776, 0.783, 0.794, 0.776, 0.779, 0.777, 0.765, 0.765, 0.771, 0.772, 0.787, 0.772, 0.7899999999999999, 0.786, 0.7779999999999999, 0.772, 0.796, 0.791, 0.776]])

bo_50_cm = np.array([[0.0, 0.18, 0.538, 0.0, 1.0219999999999998, 0.5345, 0.0, 0.34750000000000003, 0.0, 0.0215, 1.5370000000000001, 1.6990000000000003, 0.0, 1.6990000000000003, 0.0, 1.705, 1.705, 1.59, 1.673, 0.0, 1.59, 1.5765, 1.705, 1.705, 1.705, 1.7400000000000002, 1.3935000000000002, 0.0, 1.7675, 1.2400000000000002, 0.0, 0.192, 1.219, 1.7149999999999999, 1.534, 1.705, 1.7155, 1.3935000000000002, 0.0, 1.6865, 1.7825000000000002, 1.721, 1.705, 1.2400000000000002, 0.0, 1.5615, 1.7395, 1.705, 1.7335, 1.7005], [0.176, 0.0, 0.861, 0.868, 0.6825, 0.8350000000000002, 0.5029999999999999, 0.0, 0.0, 0.341, 0.0, 0.0, 0.0, 0.333, 0.0, 0.5365, 0.48150000000000004, 0.5365, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.992, 0.992, 0.992, 0.9734999999999999, 0.992, 0.9734999999999999, 0.992, 0.992, 0.9734999999999999, 0.36150000000000004, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999, 0.9734999999999999], [1.704, 1.0394999999999999, 0.3445, 0.0, 0.38649999999999995, 1.0219999999999998, 0.0, 0.014499999999999999, 1.7035, 1.6915, 0.0, 1.522, 1.0705000000000002, 0.0, 0.0, 0.515, 0.0215, 0.1825, 0.038, 1.496, 1.496, 1.496, 1.496, 1.496, 1.496, 1.6344999999999998, 1.6344999999999998, 1.6344999999999998, 1.7, 1.6344999999999998, 1.6625, 1.6344999999999998, 0.0, 1.7015, 1.6834999999999998, 1.488, 1.383, 0.0, 1.6344999999999998, 1.3945, 1.6344999999999998, 1.6344999999999998, 1.6935000000000002, 1.7055, 1.5215, 0.36900000000000005, 0.8265, 1.524, 1.59, 0.344], [0.337, 0.8684999999999998, 0.0, 0.0, 0.0, 0.0, 1.7570000000000001, 0.0, 0.0, 0.4995, 1.3875, 1.358, 1.2235, 0.0, 1.6705, 0.0, 0.0, 1.0205, 1.3675, 1.2840000000000003, 1.1880000000000002, 0.0, 0.9259999999999999, 1.7230000000000003, 1.5360000000000003, 1.004, 1.385, 0.0, 1.3824999999999998, 1.2235, 1.2840000000000003, 1.3895, 0.024, 0.7314999999999999, 1.1880000000000002, 0.507, 1.1985, 0.3905, 0.1675, 1.288, 1.3715, 0.0, 1.3625000000000003, 1.2840000000000003, 1.385, 0.0, 1.3619999999999999, 1.5385, 1.3889999999999998, 1.3655000000000002], [0.0, 0.8664999999999999, 1.1444999999999999, 1.7100000000000002, 0.7304999999999999, 1.3495, 0.178, 0.193, 0.0, 0.0, 1.6844999999999999, 1.6745, 0.0, 1.72, 0.0, 0.0, 0.0, 1.384, 1.384, 1.384, 1.5675000000000001, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72, 1.72]])

bo_50_sm = np.array([[0.4, 0.6, 0.2, 0.4, 0.8, 0.4, 0.2, 0.0, 0.0, 0.8, 0.2, 0.0, 0.4, 0.8, 0.8, 0.0, 0.6, 0.8, 1.0, 0.0, 1.0, 1.0, 1.0, 0.8, 1.0, 1.0, 0.8, 1.0, 0.8, 0.8, 0.8, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.6, 1.0, 1.0, 1.0, 1.0, 1.0, 0.8, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0], [0.6, 0.0, 0.0, 0.0, 0.6, 0.6, 0.0, 0.0, 1.0, 0.0, 0.0, 0.2, 0.0, 0.8, 0.8, 0.6, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.8, 1.0, 0.8, 1.0, 0.4, 1.0, 0.8, 0.4, 0.8, 0.6, 1.0, 0.0, 0.4, 0.8, 0.8, 0.0], [1.0, 0.8, 1.0, 0.0, 0.8, 0.6, 0.0, 0.0, 0.8, 1.0, 1.0, 1.0, 0.8, 1.0, 0.0, 0.0, 0.2, 0.6, 0.0, 0.8, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.8, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.4, 1.0, 1.0, 0.0, 0.0, 0.0, 0.2, 0.0, 0.8, 1.0, 0.6, 1.0, 1.0, 1.0], [0.6, 0.8, 0.2, 0.0, 0.0, 0.0, 1.0, 0.8, 0.0, 0.2, 1.0, 0.0, 0.8, 0.8, 1.0, 1.0, 0.6, 0.0, 1.0, 1.0, 1.0, 0.8, 1.0, 1.0, 1.0, 0.8, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.8, 1.0, 0.8, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.8, 1.0, 1.0, 1.0, 1.0, 1.0], [0.2, 0.8, 1.0, 1.0, 0.4, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.8, 1.0, 1.0, 1.0, 0.4, 1.0, 0.8, 1.0, 1.0, 1.0, 1.0, 1.0, 0.2, 1.0, 1.0, 1.0, 0.6, 1.0, 1.0, 1.0, 1.0, 0.6, 1.0, 0.4, 1.0, 1.0, 1.0, 1.0, 1.0, 0.4, 0.0]])

dqn_50_cm = np.array([[1.595, 0.0, 1.733, 1.714, 1.739, 1.729, 0.855, 0.0, 0.0, 0.338, 1.393, 0.356, 0.0, 1.574, 1.704, 1.68, 0.0, 1.23, 0.0, 1.692, 1.736, 1.694, 1.211, 0.0, 1.554, 1.393, 1.704, 0.858, 0.862, 0.866, 0.986, 1.527, 1.684, 0.848, 0.736, 0.688, 1.697, 1.748, 1.597, 0.837, 0.0, 0.549, 1.368, 1.749, 1.714, 0.509, 1.357, 0.355, 0.882, 0.0], [0.339, 0.0, 1.716, 1.564, 0.879, 1.378, 1.724, 1.649, 1.741, 1.699, 1.697, 1.556, 1.6, 1.583, 1.531, 1.54, 1.706, 0.34, 0.704, 0.0, 1.682, 1.696, 1.668, 1.029, 0.349, 1.719, 1.722, 0.708, 0.361, 1.527, 1.659, 1.68, 0.888, 0.874, 0.884, 0.989, 1.685, 0.862, 1.693, 1.726, 1.556, 1.393, 1.063, 1.394, 0.903, 0.692, 1.56, 0.342, 1.227, 1.52], [1.721, 0.0, 1.4, 0.179, 0.891, 1.727, 0.524, 1.73, 1.533, 0.862, 0.998, 1.533, 1.04, 1.245, 0.847, 0.333, 1.702, 1.773, 0.522, 1.713, 1.054, 1.237, 0.332, 1.248, 1.746, 1.737, 1.73, 0.51, 1.187, 1.234, 0.886, 0.523, 0.524, 1.729, 1.67, 1.741, 1.039, 0.582, 1.326, 1.692, 1.044, 1.036, 0.0, 1.392, 1.66, 1.688, 0.0, 0.52, 1.554, 1.686], [1.715, 0.0, 1.758, 1.547, 1.376, 1.678, 1.667, 1.157, 1.547, 1.567, 1.331, 1.707, 0.694, 1.689, 1.686, 1.192, 0.895, 0.0, 1.179, 0.689, 1.72, 1.336, 1.731, 1.049, 0.731, 1.017, 0.682, 0.0, 1.729, 1.743, 0.181, 1.214, 1.698, 1.39, 0.528, 1.043, 0.709, 0.0, 1.704, 1.693, 1.707, 1.012, 1.175, 1.68, 0.893, 0.879, 1.759, 1.223, 1.226, 0.846], [1.044, 1.316, 0.178, 0.862, 1.722, 0.34, 0.0, 1.571, 1.6, 1.545, 0.838, 0.72, 1.368, 1.567, 1.05, 1.679, 1.06, 1.73, 1.224, 0.182, 1.728, 1.203, 0.0, 1.045, 1.498, 0.0, 0.352, 0.0, 1.725, 1.73, 1.682, 0.873, 1.023, 0.9, 1.701, 1.712, 1.353, 1.725, 1.191, 1.175, 1.032, 0.872, 1.554, 1.216, 1.068, 1.714, 1.02, 0.855, 1.081, 1.383]])

dqn_50_sp = np.array([[0.758, 0.773, 0.787, 0.773, 0.794, 0.787, 0.782, 0.785, 0.774, 0.786, 0.782, 0.778, 0.779, 0.783, 0.767, 0.769, 0.782, 0.775, 0.769, 0.785, 0.787, 0.775, 0.775, 0.772, 0.779, 0.78, 0.786, 0.791, 0.779, 0.781, 0.782, 0.782, 0.772, 0.768, 0.774, 0.786, 0.787, 0.774, 0.785, 0.778, 0.772, 0.772, 0.769, 0.77, 0.785, 0.773, 0.772, 0.791, 0.788, 0.79], [0.771, 0.779, 0.775, 0.779, 0.773, 0.769, 0.78, 0.784, 0.783, 0.791, 0.78, 0.778, 0.788, 0.774, 0.774, 0.781, 0.776, 0.767, 0.778, 0.775, 0.777, 0.788, 0.768, 0.772, 0.761, 0.789, 0.774, 0.776, 0.774, 0.783, 0.771, 0.773, 0.769, 0.782, 0.777, 0.785, 0.774, 0.778, 0.776, 0.77, 0.786, 0.78, 0.776, 0.779, 0.778, 0.769, 0.787, 0.774, 0.773, 0.781], [0.788, 0.769, 0.788, 0.789, 0.785, 0.783, 0.759, 0.773, 0.791, 0.765, 0.785, 0.784, 0.774, 0.778, 0.774, 0.798, 0.79, 0.779, 0.776, 0.777, 0.777, 0.775, 0.768, 0.783, 0.765, 0.78, 0.781, 0.782, 0.779, 0.784, 0.787, 0.795, 0.774, 0.782, 0.777, 0.775, 0.774, 0.771, 0.783, 0.784, 0.777, 0.781, 0.774, 0.789, 0.77, 0.781, 0.77, 0.791, 0.783, 0.786], [0.776, 0.775, 0.772, 0.78, 0.794, 0.769, 0.788, 0.776, 0.763, 0.778, 0.781, 0.797, 0.786, 0.78, 0.787, 0.777, 0.762, 0.777, 0.789, 0.786, 0.775, 0.787, 0.797, 0.773, 0.777, 0.772, 0.783, 0.781, 0.774, 0.784, 0.772, 0.768, 0.776, 0.785, 0.777, 0.785, 0.77, 0.767, 0.784, 0.769, 0.784, 0.8, 0.771, 0.789, 0.777, 0.78, 0.79, 0.774, 0.78, 0.776], [0.773, 0.772, 0.786, 0.78, 0.782, 0.772, 0.771, 0.774, 0.775, 0.781, 0.784, 0.773, 0.791, 0.786, 0.767, 0.787, 0.782, 0.784, 0.774, 0.79, 0.779, 0.781, 0.776, 0.771, 0.769, 0.776, 0.778, 0.786, 0.79, 0.782, 0.785, 0.782, 0.783, 0.768, 0.793, 0.783, 0.769, 0.782, 0.791, 0.779, 0.776, 0.785, 0.775, 0.77, 0.785, 0.773, 0.783, 0.777, 0.792, 0.779]])

dqn_50_sm = np.array([[0.0, 0.0, 0.6, 0.2, 1.0, 1.0, 0.8, 0.0, 0.0, 0.0, 0.2, 0.0, 0.0, 0.2, 1.0, 0.2, 0.0, 0.2, 0.0, 0.2, 0.2, 0.2, 0.2, 0.0, 0.6, 0.2, 0.6, 0.2, 0.2, 0.2, 0.2, 1.0, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 1.0, 0.2, 0.0, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.6, 0.2, 0.2], [0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.8, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 1.0, 0.0, 0.8, 1.0, 0.0, 1.0, 1.0, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.0, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.0, 0.2, 0.2, 0.2, 0.8, 1.0, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 1.0, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.0, 0.2, 0.2, 0.2, 0.0, 0.2, 0.2, 0.2], [1.0, 0.0, 1.0, 0.4, 1.0, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 1.0, 0.0, 1.0, 0.4, 0.4, 0.4, 0.0, 1.0, 1.0, 0.4, 0.4, 1.0, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.0, 0.4, 0.4, 1.0, 0.6, 0.4, 1.0, 0.4, 0.4, 0.4, 0.4, 0.2, 0.4, 1.0, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4], [1.0, 0.0, 0.8, 0.8, 1.0, 0.0, 0.0, 1.0, 0.8, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.8, 0.0, 0.8, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.8, 0.8, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]])

ppo_10_cm = np.array([[0.0, 1.548, 1.702, 0.539, 1.723, 1.524, 1.524, 1.702, 1.702, 1.702], [0.344, 1.531, 0.167, 1.724, 1.724, 1.03, 0.878, 1.685, 1.685, 1.685], [0.674, 1.054, 1.712, 1.626, 1.56, 0.368, 1.7, 1.532, 1.054, 1.712], [1.728, 1.704, 0.0, 0.684, 0.373, 0.684, 0.335, 1.706, 0.335, 0.713], [0.338, 1.678, 1.694, 1.71, 1.71, 1.012, 1.686, 1.686, 1.686, 1.686]])

ppo_10_sp = np.array([[0.772, 0.769, 0.773, 0.771, 0.774, 0.778, 0.789, 0.774, 0.778, 0.782], [0.768, 0.792, 0.772, 0.796, 0.79, 0.781, 0.779, 0.772, 0.796, 0.78], [0.78, 0.777, 0.767, 0.808, 0.771, 0.771, 0.791, 0.764, 0.784, 0.782], [0.77, 0.777, 0.773, 0.772, 0.773, 0.78, 0.777, 0.777, 0.78, 0.776], [0.784, 0.779, 0.774, 0.787, 0.786, 0.786, 0.786, 0.797, 0.778, 0.797]])

ppo_50_sp = np.array([[0.772, 0.769, 0.773, 0.771, 0.774, 0.782, 0.778, 0.789, 0.782, 0.791, 0.792, 0.782, 0.772, 0.785, 0.785, 0.785, 0.785, 0.785, 0.785, 0.789, 0.774, 0.774, 0.774, 0.774, 0.774, 0.785, 0.773, 0.789, 0.792, 0.792, 0.768, 0.777, 0.784, 0.768, 0.772, 0.785, 0.777, 0.77, 0.768, 0.768, 0.768, 0.785, 0.785, 0.768, 0.785, 0.785, 0.777, 0.781, 0.777, 0.784], [0.768, 0.792, 0.772, 0.796, 0.79, 0.781, 0.779, 0.774, 0.792, 0.772, 0.796, 0.79, 0.787, 0.789, 0.768, 0.772, 0.796, 0.79, 0.768, 0.78, 0.778, 0.793, 0.789, 0.771, 0.772, 0.796, 0.771, 0.792, 0.778, 0.78, 0.771, 0.771, 0.793, 0.793, 0.779, 0.793, 0.793, 0.793, 0.793, 0.793, 0.793, 0.792, 0.768, 0.778, 0.779, 0.792, 0.793, 0.779, 0.793, 0.778], [0.78, 0.777, 0.767, 0.808, 0.771, 0.784, 0.784, 0.771, 0.788, 0.791, 0.77, 0.771, 0.771, 0.784, 0.782, 0.789, 0.792, 0.778, 0.79, 0.782, 0.791, 0.771, 0.771, 0.789, 0.782, 0.791, 0.784, 0.782, 0.78, 0.777, 0.782, 0.784, 0.782, 0.771, 0.795, 0.795, 0.782, 0.795, 0.764, 0.788, 0.778, 0.778, 0.778, 0.778, 0.795, 0.784, 0.782, 0.778, 0.786, 0.795], [0.77, 0.777, 0.773, 0.772, 0.773, 0.78, 0.777, 0.777, 0.788, 0.776, 0.793, 0.777, 0.788, 0.771, 0.776, 0.775, 0.782, 0.773, 0.773, 0.777, 0.788, 0.775, 0.782, 0.775, 0.775, 0.773, 0.773, 0.77, 0.775, 0.782, 0.795, 0.788, 0.789, 0.788, 0.788, 0.784, 0.788, 0.772, 0.773, 0.766, 0.782, 0.795, 0.782, 0.795, 0.773, 0.782, 0.795, 0.788, 0.788, 0.771], [0.784, 0.779, 0.774, 0.787, 0.786, 0.786, 0.786, 0.778, 0.778, 0.79, 0.778, 0.774, 0.777, 0.774, 0.778, 0.79, 0.778, 0.784, 0.776, 0.778, 0.79, 0.774, 0.774, 0.778, 0.776, 0.774, 0.774, 0.774, 0.778, 0.79, 0.77, 0.786, 0.79, 0.775, 0.776, 0.776, 0.777, 0.776, 0.776, 0.776, 0.776, 0.776, 0.771, 0.787, 0.771, 0.787, 0.776, 0.784, 0.786, 0.778]])

ppo_50_cm = np.array([[0.0, 1.548, 1.702, 0.539, 1.723, 1.524, 0.366, 1.702, 0.539, 1.723, 1.723, 1.702, 0.539, 1.723, 1.762, 1.702, 0.539, 1.723, 1.762, 1.702, 0.539, 1.723, 1.76, 1.014, 1.702, 0.539, 1.723, 0.369, 0.706, 1.723, 1.698, 1.702, 0.539, 1.723, 1.546, 0.369, 0.706, 1.76, 1.698, 1.531, 1.756, 0.513, 1.702, 1.531, 1.531, 1.67, 1.67, 1.668, 1.702, 1.67], [0.344, 1.531, 0.167, 1.724, 1.724, 1.03, 1.558, 1.724, 1.685, 0.0, 1.685, 0.0, 1.702, 1.736, 0.0, 1.685, 0.0, 1.03, 1.558, 1.549, 0.167, 1.685, 1.736, 1.702, 1.685, 1.702, 0.896, 1.685, 0.878, 1.742, 0.0, 1.685, 1.736, 1.685, 1.03, 1.742, 1.736, 1.685, 1.685, 1.699, 0.873, 1.03, 0.548, 1.693, 1.384, 1.652, 1.699, 1.518, 1.699, 1.699], [0.674, 1.054, 1.712, 1.626, 1.639, 0.678, 1.047, 1.215, 1.7, 1.396, 0.181, 1.054, 1.532, 1.054, 1.712, 1.7, 1.396, 0.181, 1.054, 1.399, 1.399, 1.712, 1.7, 1.031, 1.054, 1.7, 1.047, 1.56, 0.368, 1.396, 1.2, 1.399, 1.188, 1.396, 1.396, 1.188, 1.2, 1.697, 1.708, 1.684, 1.71, 0.678, 1.047, 1.71, 0.181, 1.316, 1.2, 1.71, 1.702, 1.684], [1.728, 1.704, 0.0, 0.684, 0.0, 0.684, 0.0, 0.684, 0.0, 0.684, 0.0, 0.684, 0.0, 0.684, 0.0, 0.684, 0.0, 0.684, 0.0, 0.684, 0.182, 0.684, 0.335, 0.684, 1.71, 0.508, 0.0, 0.684, 0.0, 0.684, 1.062, 0.352, 0.684, 0.352, 0.684, 1.062, 0.182, 1.706, 1.062, 1.325, 1.062, 1.552, 0.355, 1.731, 1.682, 1.675, 1.71, 1.552, 0.53, 1.34], [0.338, 1.678, 1.694, 1.71, 0.175, 1.678, 1.694, 1.686, 1.686, 1.686, 1.686, 1.686, 1.686, 1.686, 1.551, 1.551, 0.352, 1.678, 1.694, 1.679, 1.551, 1.012, 1.201, 1.698, 1.705, 1.707, 1.686, 1.679, 1.551, 1.012, 1.698, 0.0, 1.679, 1.654, 1.679, 1.686, 1.012, 1.551, 0.853, 1.686, 1.705, 1.551, 1.672, 1.672, 1.042, 1.686, 1.679, 1.717, 1.686, 1.717]])

ppo_50_sm = np.array([[0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.2, 1.0, 0.0, 1.0, 0.6, 0.2, 1.0, 0.6, 0.6, 0.0, 0.6, 0.6, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.8, 0.0, 0.2, 0.0, 0.0, 0.2, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.2, 0.0, 0.0, 0.0, 1.0, 0.0, 0.6, 0.0, 0.0, 0.0, 0.6], [0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0], [0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.2, 0.0, 0.0, 0.0, 0.8, 0.0, 0.0, 0.2, 0.0, 0.0, 0.0, 0.0, 0.0, 0.2, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.2, 0.8, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.4, 0.6, 0.0, 0.6, 0.4, 0.6, 0.4, 0.6, 1.0, 0.4, 0.6, 0.4, 0.6, 0.0, 0.6, 0.4, 0.6, 0.4, 0.6, 0.0, 0.6, 0.0, 0.6, 0.4, 0.6, 0.0, 0.6, 0.0, 0.6, 0.0, 0.6, 0.0, 0.6, 0.0, 0.6, 0.4, 0.0, 0.2, 0.4, 0.0, 0.4, 0.0, 0.0, 0.4, 0.0, 0.0, 0.4, 1.0, 0.0, 0.0], [0.0, 1.0, 0.8, 0.6, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.8, 0.8, 0.8, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.8, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]])

ppo_10_sm = np.array([[0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.2, 1.0, 0.2, 1.0], [0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0], [0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0], [0.4, 0.6, 1.0, 0.0, 0.6, 1.0, 0.4, 0.4, 1.0, 0.4], [0.0, 1.0, 0.8, 0.6, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0]])

rs_10_sm = np.array([[0.4, 0.6, 0.2, 0.4, 0.8, 0.4, 0.2, 0.0, 0.0, 0.8], [0.6, 0.0, 0.0, 0.0, 0.6, 0.6, 0.0, 0.0, 1.0, 0.0], [1.0, 0.8, 1.0, 0.0, 0.8, 0.6, 0.0, 0.0, 0.8, 1.0], [0.6, 0.8, 0.2, 0.0, 0.0, 0.0, 1.0, 0.8, 0.0, 0.2], [0.2, 0.8, 1.0, 1.0, 0.4, 1.0, 0.0, 0.0, 0.0, 0.0]])

bo_10_sm = np.array([[0.4, 0.6, 0.2, 0.4, 0.8, 0.4, 0.2, 0.0, 0.0, 0.8], [0.6, 0.0, 0.0, 0.0, 0.6, 0.6, 0.0, 0.0, 1.0, 0.0], [1.0, 0.8, 1.0, 0.0, 0.8, 0.6, 0.0, 0.0, 0.8, 1.0], [0.6, 0.8, 0.2, 0.0, 0.0, 0.0, 1.0, 0.8, 0.0, 0.2], [0.2, 0.8, 1.0, 1.0, 0.4, 1.0, 0.0, 0.0, 0.0, 0.0]])

dqn_10_sm = np.array([[0.0, 0.0, 0.6, 0.2, 0.6, 1.0, 0.2, 0.2, 0.6, 0.2], [0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0], [0.0, 0.0, 1.0, 0.0, 0.8, 1.0, 0.2, 1.0, 1.0, 0.2], [1.0, 0.0, 1.0, 0.4, 1.0, 0.4, 0.4, 0.4, 0.4, 0.4], [0.8, 0.0, 0.8, 0.8, 1.0, 0.8, 0.0, 1.0, 0.8, 0.0]])

def get_best_performance_run(array):
    maxes = np.max(array, axis=1)
    mean = np.mean(maxes) # Max performance per run
    std = np.std(maxes)
    return [mean, std]

if __name__ == "__main__":
    # 2-D array: (runs, trials)
    
    k = 20   # use 4 for 10-trial runs, 20 for 50-trial runs
    for name, rew in [("DQN", dqn_50_sm),
                    ("PPO", ppo_50_sm),
                    ("RS",  rs_50_sm),
                    ("BO", bo_50_sm)]:
        info = sr_ci(rew, k)
        print(f"{name}: {info['mean']:.2f}  "
            f"95% CI [{info['ci_low']:.2f}, {info['ci_high']:.2f}], {np.median(gpc(rew, k))}, {gpc(rew, k)}")
    
    # Function to calculate trials to 95% of best performance
    def trials_to_95_percent(array, budget):
        best_perf = np.max(array)
        trials_list = []
        for run in array:
            reached = np.where(run >= 0.95 * best_perf)[0]
            trials = reached[0] + 1 if len(reached) > 0 else budget
            trials_list.append(trials)
        return np.array(trials_list)


    # Calculate trials for each method and budget

    means = np.array([
    [get_best_performance_run(rs_50_sm)[0], get_best_performance_run(bo_50_sm)[0], get_best_performance_run(dqn_50_sm)[0], get_best_performance_run(ppo_50_sm)[0]],  # ComplexMaze-v0
    [get_best_performance_run(rs_10_sm)[0], get_best_performance_run(bo_10_sm)[0], get_best_performance_run(dqn_10_sm)[0], get_best_performance_run(ppo_10_sm)[0]],  # ComplexMaze-v0
    ])

    # Standard deviations for each environment Ã— method
    stds = np.array([
        [get_best_performance_run(rs_50_sm)[1], get_best_performance_run(bo_50_sm)[1], get_best_performance_run(dqn_50_sm)[1], get_best_performance_run(ppo_50_sm)[1]],  # ComplexMaze-v0
        [get_best_performance_run(rs_10_sm)[1], get_best_performance_run(bo_10_sm)[1], get_best_performance_run(dqn_10_sm)[1], get_best_performance_run(ppo_10_sm)[1]],
    ])

    print(means)
    print(stds)

    # ComplexMaze
    trials_dqn_10_cm = trials_to_95_percent(dqn_10_cm, 10)
    trials_dqn_50_cm = trials_to_95_percent(dqn_50_cm, 50)
    trials_ppo_10_cm = trials_to_95_percent(ppo_10_cm, 10)
    trials_ppo_50_cm = trials_to_95_percent(ppo_50_cm, 50)
    trials_bo_10_cm = trials_to_95_percent(bo_10_cm, 10)
    trials_bo_50_cm = trials_to_95_percent(bo_50_cm, 50)
    trials_rs_10_cm = trials_to_95_percent(rs_10_cm, 10)
    trials_rs_50_cm = trials_to_95_percent(rs_50_cm, 50)

    # Sepsis
    trials_dqn_10_sp = trials_to_95_percent(dqn_10_sp, 10)
    trials_dqn_50_sp = trials_to_95_percent(dqn_50_sp, 50)
    trials_ppo_10_sp = trials_to_95_percent(ppo_10_sp, 10)
    trials_ppo_50_sp = trials_to_95_percent(ppo_50_sp, 50)
    trials_bo_10_sp = trials_to_95_percent(bo_10_sp, 10)
    trials_bo_50_sp = trials_to_95_percent(bo_50_sp, 50)
    trials_rs_10_sp = trials_to_95_percent(rs_10_sp, 10)
    trials_rs_50_sp = trials_to_95_percent(rs_50_sp, 50)

    trials_dqn_10_sm = trials_to_95_percent(dqn_10_sm, 10)
    trials_dqn_50_sm = trials_to_95_percent(dqn_50_sm, 50)
    trials_ppo_10_sm = trials_to_95_percent(ppo_10_sm, 10)
    trials_ppo_50_sm = trials_to_95_percent(ppo_50_sm, 50)
    trials_bo_10_sm = trials_to_95_percent(bo_10_sm, 10)
    trials_bo_50_sm = trials_to_95_percent(bo_50_sm, 50)
    trials_rs_10_sm = trials_to_95_percent(rs_10_sm, 10)
    trials_rs_50_sm = trials_to_95_percent(rs_50_sm, 50)

    print(trials_ppo_50_sm)

    for data in [trials_rs_50_sm, trials_bo_50_sm,trials_dqn_50_sm, trials_ppo_50_sm]:
        median = np.median(data)

        # Calculate the IQR
        q1 = np.percentile(data, 25)
        q3 = np.percentile(data, 75)
        iqr = q3 - q1

        # Calculate the standard deviation
        std_dev = np.std(data)
        print(median, iqr, std_dev)

    # Create figure with two subplots
    fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 6), sharey=True)

    # Methods and budgets
    methods = ['DQN', 'PPO', 'Bayesian optimisation', 'Random search']
    colors = {'10': 'lightblue', '50': 'navy'}

    legend_handles = [
        Patch(facecolor='lightblue', label='10-trial budget'),
        Patch(facecolor='navy', label='50-trial budget'),
    ]

    # Plot for ComplexMaze
    data_cm = [
        trials_dqn_10_cm, trials_dqn_50_cm,
        trials_ppo_10_cm, trials_ppo_50_cm,
        trials_bo_10_cm, trials_bo_50_cm,
        trials_rs_10_cm, trials_rs_50_cm
    ]
    positions = np.arange(len(methods)) * 1.5
    for i, method in enumerate(methods):
        box = ax1.boxplot(
            [data_cm[i * 2], data_cm[i * 2 + 1]],
            positions=[positions[i] - 0.35, positions[i] + 0.35],
            widths=0.35,
            patch_artist=True,
            whis=[0, 100],
            medianprops={'linewidth': 2, 'color': 'red'},
            showmeans=True,
            meanprops={'marker': '^', 'markerfacecolor': 'green', 'markeredgecolor': 'green', 'markersize': 5}
        )
        for patch, budget in zip(box['boxes'], ['10', '50']):
            patch.set_facecolor(colors[budget])

    ax1.axhline(y=10, color='gray', linestyle='--', alpha=0.7, label='Budget Ceiling = 10')
    ax1.axhline(y=50, color='blue', linestyle='--', alpha=0.7, label='Budget Ceiling = 50')
    ax1.set_title('ComplexMaze-v0', fontsize=12)
    ax1.set_xticks(positions)
    ax1.set_xticklabels(methods)
    ax1.set_ylabel('Trials to reach 95% of maximum performance', fontsize=10)
    ax1.grid(True, linestyle='--', alpha=0.7)
    ax1.legend()

    # Plot for Sepsis
    data_sp = [
        trials_dqn_10_sp, trials_dqn_50_sp,
        trials_ppo_10_sp, trials_ppo_50_sp,
        trials_bo_10_sp, trials_bo_50_sp,
        trials_rs_10_sp, trials_rs_50_sp
    ]
    for i, method in enumerate(methods):
        box = ax2.boxplot(
            [data_sp[i * 2], data_sp[i * 2 + 1]],
            positions=[positions[i] - 0.35, positions[i] + 0.35],
            widths=0.35,
            patch_artist=True,
            whis=[0, 100],
            medianprops={'linewidth': 2, 'color': 'red'},
            showmeans=True,
            meanprops={'marker': '^', 'markerfacecolor': 'green', 'markeredgecolor': 'green', 'markersize': 5}
        )
        for patch, budget in zip(box['boxes'], ['10', '50']):
            patch.set_facecolor(colors[budget])

    ax2.axhline(y=10, color='gray', linestyle='--', alpha=0.7, label='Budget Ceilings')
    ax2.axhline(y=50, color='blue', linestyle='--', alpha=0.7)
    ax2.set_title('Sepsis/ICU-Sepsis-v2', fontsize=12)
    ax2.set_xticks(positions)
    ax2.set_xticklabels(methods)
    ax2.grid(True, linestyle='--', alpha=0.7)
    ax2.legend()
    ax2.legend(handles=legend_handles, loc='upper right')

    plt.tight_layout()
    plt.show()

    fig, ax = plt.subplots(1, 1, figsize=(7, 6), sharey=True)

    # Methods and budgets
    methods = ['DQN', 'PPO', 'Bayesian optimisation', 'Random search']
    colors = {'10': 'lightblue', '50': 'navy'}

    legend_handles = [
        Patch(facecolor='lightblue', label='10-trial budget'),
        Patch(facecolor='navy', label='50-trial budget'),
    ]
    # Plot for Sepsis
    data_sm = [
        trials_dqn_10_sm, trials_dqn_50_sm,
        trials_ppo_10_sm, trials_ppo_50_sm,
        trials_bo_10_sm, trials_bo_50_sm,
        trials_rs_10_sm, trials_rs_50_sm
    ]
    for i, method in enumerate(methods):
        box = ax.boxplot(
            [data_sm[i * 2], data_sm[i * 2 + 1]],
            positions=[positions[i] - 0.35, positions[i] + 0.35],
            widths=0.35,
            patch_artist=True,
            whis=[0, 100],
            medianprops={'linewidth': 2, 'color': 'red'},
            showmeans=True,
            meanprops={'marker': '^', 'markerfacecolor': 'green', 'markeredgecolor': 'green', 'markersize': 5}
        )
        for patch, budget in zip(box['boxes'], ['10', '50']):
            patch.set_facecolor(colors[budget])

    ax.axhline(y=10, color='gray', linestyle='--', alpha=0.7, label='Budget Ceilings')
    ax.axhline(y=50, color='blue', linestyle='--', alpha=0.7)
    ax.set_title('SimpleMaze-v0', fontsize=12)
    ax.set_xticks(positions)
    ax.set_xticklabels(methods)
    ax.grid(True, linestyle='--', alpha=0.7)
    ax.legend()
    ax.legend(handles=legend_handles, loc='upper right')

    plt.tight_layout()
    plt.show()
    
    # ComplexMaze
    means_cm = {
        'DQN_10': np.mean(get_best_performance(dqn_10_cm)),
        'DQN_50': np.mean(get_best_performance(dqn_50_cm)),
        'PPO_10': np.mean(get_best_performance(ppo_10_cm)),
        'PPO_50': np.mean(get_best_performance(ppo_50_cm)),
        'Bayesian optimisation_10': np.mean(get_best_performance(bo_10_cm)),
        'Bayesian optimisation_50': np.mean(get_best_performance(bo_50_cm)),
        'Random search_10': np.mean(get_best_performance(rs_10_cm)),
        'Random search_50': np.mean(get_best_performance(rs_50_cm))
    }
    stds_cm = {
        'DQN_10': np.std(get_best_performance(dqn_10_cm)),
        'DQN_50': np.std(get_best_performance(dqn_50_cm)),
        'PPO_10': np.std(get_best_performance(ppo_10_cm)),
        'PPO_50': np.std(get_best_performance(ppo_50_cm)),
        'Bayesian optimisation_10': np.std(get_best_performance(bo_10_cm)),
        'Bayesian optimisation_50': np.std(get_best_performance(bo_50_cm)),
        'Random search_10': np.std(get_best_performance(rs_10_cm)),
        'Random search_50': np.std(get_best_performance(rs_50_cm))
    }

    # Sepsis
    means_sp = {
        'DQN_10': np.mean(get_best_performance(dqn_10_sp)),
        'DQN_50': np.mean(get_best_performance(dqn_50_sp)),
        'PPO_10': np.mean(get_best_performance(ppo_10_sp)),
        'PPO_50': np.mean(get_best_performance(ppo_50_sp)),
        'Bayesian optimisation_10': np.mean(get_best_performance(bo_10_sp)),
        'Bayesian optimisation_50': np.mean(get_best_performance(bo_50_sp)),
        'Random search_10': np.mean(get_best_performance(rs_10_sp)),
        'Random search_50': np.mean(get_best_performance(rs_50_sp))
    }
    stds_sp = {
        'DQN_10': np.std(get_best_performance(dqn_10_sp)),
        'DQN_50': np.std(get_best_performance(dqn_50_sp)),
        'PPO_10': np.std(get_best_performance(ppo_10_sp)),
        'PPO_50': np.std(get_best_performance(ppo_50_sp)),
        'Bayesian optimisation_10': np.std(get_best_performance(bo_10_sp)),
        'Bayesian optimisation_50': np.std(get_best_performance(bo_50_sp)),
        'Random search_10': np.std(get_best_performance(rs_10_sp)),
        'Random search_50': np.std(get_best_performance(rs_50_sp))
    }

    means_sm = {
        'DQN_10': np.mean(get_best_performance(dqn_10_sm)),
        'DQN_50': np.mean(get_best_performance(dqn_50_sm)),
        'PPO_10': np.mean(get_best_performance(ppo_10_sm)),
        'PPO_50': np.mean(get_best_performance(ppo_50_sm)),
        'Bayesian optimisation_10': np.mean(get_best_performance(bo_10_sm)),
        'Bayesian optimisation_50': np.mean(get_best_performance(bo_50_sm)),
        'Random search_10': np.mean(get_best_performance(rs_10_sm)),
        'Random search_50': np.mean(get_best_performance(rs_50_sm))
    }
    stds_sm = {
        'DQN_10': np.std(get_best_performance(dqn_10_sm)),
        'DQN_50': np.std(get_best_performance(dqn_50_sm)),
        'PPO_10': np.std(get_best_performance(ppo_10_sm)),
        'PPO_50': np.std(get_best_performance(ppo_50_sm)),
        'Bayesian optimisation_10': np.std(get_best_performance(bo_10_sm)),
        'Bayesian optimisation_50': np.std(get_best_performance(bo_50_sm)),
        'Random search_10': np.std(get_best_performance(rs_10_sm)),
        'Random search_50': np.std(get_best_performance(rs_50_sm))
    }


    # Wilcoxon signed-rank test for p-values
    def get_p_values(data_10, data_50):
        best_10 = get_best_performance(data_10)
        best_50 = get_best_performance(data_50)
        stat, p = wilcoxon(best_10, best_50)
        return p if p < 0.05 else None  # Only show significant p-values


    p_values_cm = {
        'DQN': get_p_values(dqn_10_cm, dqn_50_cm),
        'PPO': get_p_values(ppo_10_cm, ppo_50_cm),
        'Bayesian optimisation': get_p_values(bo_10_cm, bo_50_cm),
        'Random search': get_p_values(rs_10_cm, rs_50_cm)
    }
    p_values_sp = {
        'DQN': get_p_values(dqn_10_sp, dqn_50_sp),
        'PPO': get_p_values(ppo_10_sp, ppo_50_sp),
        'Bayesian optimisation': get_p_values(bo_10_sp, bo_50_sp),
        'Random search': get_p_values(rs_10_sp, rs_50_sp)
    }

    p_values_sm = {
        'DQN': None,
        'PPO': None,
        'Bayesian optimisation': None,
        'Random search': None
    }


    # Determine rank changes for asterisks
    def get_ranks(means, methods=['DQN', 'PPO', 'Bayesian optimisation', 'Random search']):
        ranks_10 = sorted([(means[f'{m}_10'], m) for m in methods], reverse=True)
        ranks_50 = sorted([(means[f'{m}_50'], m) for m in methods], reverse=True)
        rank_dict_10 = {m: i + 1 for i, (_, m) in enumerate(ranks_10)}
        rank_dict_50 = {m: i + 1 for i, (_, m) in enumerate(ranks_50)}
        return {m: rank_dict_10[m] != rank_dict_50[m] for m in methods}


    rank_changes_cm = get_ranks(means_cm)
    rank_changes_sp = get_ranks(means_sp)
    rank_changes_sm = {'DQN': False, 'PPO': False, 'Bayesian optimisation': True, 'Random search': True}

    # Create figure with two subplots
    fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 6), sharey=True)

    # Methods, budgets, and colors
    methods = ['DQN', 'PPO', 'Bayesian optimisation', 'Random search']
    budgets = ['10', '50']
    colors = sns.color_palette("colorblind", 4)  # Color-blind safe palette
    bar_width = 0.18  # 0.8 * group spacing (0.225 = 0.18 / 0.8)
    positions = np.arange(len(budgets)) * 1.5

    # Determine y-axis limits
    all_means = list(means_cm.values()) + list(means_sp.values())
    all_stds = list(stds_cm.values()) + list(stds_sp.values())
    y_max = max([m + s for m, s in zip(all_means, all_stds)]) * 1.1
    y_min = min([m - s for m, s in zip(all_means, all_stds)]) * 0.9
    y_min = min(y_min, 0)  # Ensure non-negative if data allows

    # Plot for ComplexMaze
    rs_50_best_cm = np.max(rs_50_cm)  # Best RS-50 value for ComplexMaze
    for i, method in enumerate(methods):
        means = [means_cm[f'{method}_10'], means_cm[f'{method}_50']]
        stds = [stds_cm[f'{method}_10'], stds_cm[f'{method}_50']]
        pos = [positions[j] + i * bar_width for j in range(len(budgets))]
        bars = ax1.bar(
            pos, means, bar_width, yerr=stds, capsize=5,
            color=colors[i], label=method
        )
        for j, p in enumerate(pos):
            ax1.text(p, means[j] + stds[j] + 0.02 * y_max, f'{means[j]:.3f}',
                     ha='center', va='bottom', fontsize=8)
        # Add asterisks for rank changes
        if rank_changes_cm[method]:
            for j, p in enumerate(pos):
                ax1.text(p, means[j] + stds[j] + 0.05 * y_max, '*', ha='center', va='bottom', fontsize=12)
        # Add p-value brackets for significant changes
        if p_values_cm[method] is not None:
            ax1.text(pos[0] + bar_width / 2, means[0] + stds[0] + 0.1 * y_max,
                     f'p={p_values_cm[method]:.3f}', ha='center', va='bottom', fontsize=8)

    ax1.axhline(y=rs_50_best_cm, color='gray', linestyle='--', alpha=0.7, label='Random search-50 Best')
    ax1.set_title('(a) ComplexMaze-v0', fontsize=12)
    ax1.set_xticks(positions + bar_width * 1.5)
    ax1.set_xticklabels(['10 trials', '50 trials'])
    ax1.set_ylabel('Mean best performance across runs', fontsize=10)
    ax1.set_ylim(y_min, y_max)
    ax1.grid(True, linestyle='--', alpha=0.7, axis='y')
    ax1.legend()

    # Plot for Sepsis
    rs_50_best_sp = np.max(rs_50_sp)  # Best RS-50 value for Sepsis
    for i, method in enumerate(methods):
        means = [means_sp[f'{method}_10'], means_sp[f'{method}_50']]
        stds = [stds_sp[f'{method}_10'], stds_sp[f'{method}_50']]
        pos = [positions[j] + i * bar_width for j in range(len(budgets))]
        bars = ax2.bar(
            pos, means, bar_width, yerr=stds, capsize=5,
            color=colors[i], label=method
        )
        for j, p in enumerate(pos):
            ax2.text(p, means[j] + stds[j] + 0.02 * y_max, f'{means[j]:.3f}',
                     ha='center', va='bottom', fontsize=8)
        if rank_changes_sp[method]:
            for j, p in enumerate(pos):
                ax2.text(p, means[j] + stds[j] + 0.05 * y_max, '*', ha='center', va='bottom', fontsize=12)
        if p_values_sp[method] is not None:
            ax2.text(pos[0] + bar_width / 2, means[0] + stds[0] + 0.1 * y_max,
                     f'p={p_values_sp[method]:.3f}', ha='center', va='bottom', fontsize=8)

    ax2.axhline(y=rs_50_best_sp, color='gray', linestyle='--', alpha=0.7, label='Random search-50 Best')
    ax2.set_title('(b) Sepsis/ICU-Sepsis-v2', fontsize=12)
    ax2.set_xticks(positions + bar_width * 1.5)
    ax2.set_xticklabels(['10 trials', '50 trials'])
    ax2.set_ylim(y_min, y_max)
    ax2.grid(True, linestyle='--', alpha=0.7, axis='y')
    ax2.legend()

    plt.tight_layout()
    plt.show()

    fig, ax = plt.subplots(1, 1, figsize=(7, 6), sharey=True)

    # Methods, budgets, and colors
    methods = ['DQN', 'PPO', 'Bayesian optimisation', 'Random search']
    budgets = ['10', '50']
    colors = sns.color_palette("colorblind", 4)  # Color-blind safe palette
    bar_width = 0.18  # 0.8 * group spacing (0.225 = 0.18 / 0.8)
    positions = np.arange(len(budgets)) * 1.5

    # Determine y-axis limits
    all_means = list(means_sm.values())
    all_stds = list(stds_sm.values())
    y_max = max([m + s for m, s in zip(all_means, all_stds)]) * 1.1
    y_min = min([m - s for m, s in zip(all_means, all_stds)]) * 0.9
    y_min = min(y_min, 0)  # Ensure non-negative if data allows

    # Plot for ComplexMaze
    rs_50_best_sm = np.max(rs_50_sm)  # Best RS-50 value for ComplexMaze
    for i, method in enumerate(methods):
        means = [means_sm[f'{method}_10'], means_sm[f'{method}_50']]
        stds = [stds_sm[f'{method}_10'], stds_sm[f'{method}_50']]
        pos = [positions[j] + i * bar_width for j in range(len(budgets))]
        bars = ax.bar(
            pos, means, bar_width, yerr=stds, capsize=5,
            color=colors[i], label=method
        )
        for j, p in enumerate(pos):
            ax.text(p, means[j] + stds[j] + 0.02 * y_max, f'{means[j]:.3f}',
                     ha='center', va='bottom', fontsize=8)
        # Add asterisks for rank changes
        if rank_changes_sm[method]:
            for j, p in enumerate(pos):
                ax.text(p, means[j] + stds[j] + 0.05 * y_max, '*', ha='center', va='bottom', fontsize=12)
        # Add p-value brackets for significant changes
        if p_values_sm[method] is not None:
            ax.text(pos[0] + bar_width / 2, means[0] + stds[0] + 0.1 * y_max,
                     f'p={p_values_sm[method]:.3f}', ha='center', va='bottom', fontsize=8)

    ax.axhline(y=rs_50_best_sm, color='gray', linestyle='--', alpha=0.7, label='Random search-50 Best')
    ax.set_title('(c) SimpleMaze-v0', fontsize=12)
    ax.set_xticks(positions + bar_width * 1.5)
    ax.set_xticklabels(['10 trials', '50 trials'])
    ax.set_ylabel('Mean best performance across runs', fontsize=10)
    ax.set_ylim(y_min, y_max)
    ax.grid(True, linestyle='--', alpha=0.7, axis='y')
    ax.legend()

    plt.tight_layout()
    plt.show()
