from scipy.stats import bootstrap
import matplotlib.pyplot as plt
from matplotlib.patches import Patch
from scipy.stats import wilcoxon
import pandas as pd
import numpy as np
import seaborn as sns


dqn_10_cm = np.array([[1.702, 0.0, 1.682, 1.76, 1.717, 1.363, 1.717, 1.717, 1.717, 1.717], [0.34, 0.0, 1.696, 1.531, 1.288, 1.558, 1.676, 1.558, 1.558, 1.549], [0.181, 0.0, 1.532, 0.368, 1.697, 1.712, 0.37, 1.697, 1.686, 1.697], [1.637, 0.0, 1.71, 1.587, 1.34, 1.587, 1.728, 1.062, 1.587, 1.587], [1.214, 1.705, 0.869, 1.216, 1.686, 1.707, 0.0, 1.71, 1.707, 1.707]])

dqn_10_sp = np.array([[0.782, 0.774, 0.776, 0.782, 0.778, 0.787, 0.778, 0.778, 0.778, 0.782], [0.769, 0.772, 0.76, 0.771, 0.781, 0.781, 0.785, 0.781, 0.781, 0.771], [0.767, 0.772, 0.764, 0.784, 0.776, 0.767, 0.776, 0.776, 0.789, 0.791], [0.786, 0.773, 0.775, 0.775, 0.782, 0.775, 0.77, 0.773, 0.775, 0.775], [0.771, 0.776, 0.77, 0.774, 0.792, 0.784, 0.774, 0.774, 0.784, 0.784]])

dqn_10_sm = np.array([[0.0, 0.0, 0.6, 0.2, 0.6, 1.0, 0.2, 0.2, 0.6, 0.2], [0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0], [0.0, 0.0, 1.0, 0.0, 0.8, 1.0, 0.2, 1.0, 1.0, 0.2], [1.0, 0.0, 1.0, 0.4, 1.0, 0.4, 0.4, 0.4, 0.4, 0.4], [0.8, 0.0, 0.8, 0.8, 1.0, 0.8, 0.0, 1.0, 0.8, 0.0]])

bo_10_sm = np.array([[0.4, 0.6, 0.2, 0.4, 0.8, 0.4, 0.2, 0.0, 0.0, 0.8], [0.6, 0.0, 0.0, 0.0, 0.6, 0.6, 0.0, 0.0, 1.0, 0.0], [1.0, 0.8, 1.0, 0.0, 0.8, 0.6, 0.0, 0.0, 0.8, 1.0], [0.6, 0.8, 0.2, 0.0, 0.0, 0.0, 1.0, 0.8, 0.0, 0.2], [0.2, 0.8, 1.0, 1.0, 0.4, 1.0, 0.0, 0.0, 0.0, 0.0]])

bo_10_sp = np.array([[0.781, 0.768, 0.785, 0.776, 0.7849999999999999, 0.779, 0.776, 0.779, 0.7710000000000001, 0.78], [0.777, 0.772, 0.7849999999999999, 0.776, 0.784, 0.766, 0.795, 0.778, 0.779, 0.7689999999999999], [0.767, 0.773, 0.762, 0.771, 0.78, 0.779, 0.783, 0.774, 0.774, 0.779], [0.783, 0.795, 0.787, 0.7700000000000001, 0.787, 0.7709999999999999, 0.7869999999999999, 0.78, 0.7699999999999999, 0.792], [0.764, 0.7889999999999999, 0.788, 0.7729999999999999, 0.782, 0.7830000000000001, 0.764, 0.7759999999999999, 0.775, 0.7750000000000001]])

bo_10_cm = np.array([[0.0, 0.18, 0.538, 0.0, 1.0219999999999998, 0.5345, 0.0, 0.34750000000000003, 0.0, 0.0215], [0.176, 0.0, 0.861, 0.868, 0.6825, 0.8350000000000002, 0.5029999999999999, 0.0, 0.0, 0.341], [1.704, 1.0394999999999999, 0.3445, 0.0, 0.38649999999999995, 1.0219999999999998, 0.0, 0.014499999999999999, 1.7035, 1.6915], [0.337, 0.8684999999999998, 0.0, 0.0, 0.0, 0.0, 1.7570000000000001, 0.0, 0.0, 0.4995], [0.0, 0.8664999999999999, 1.1444999999999999, 1.7100000000000002, 0.7304999999999999, 1.3495, 0.178, 0.193, 0.0, 0.0]])

rs_10_sm = np.array([[0.4, 0.6, 0.2, 0.4, 0.8, 0.4, 0.2, 0.0, 0.0, 0.8], [0.6, 0.0, 0.0, 0.0, 0.6, 0.6, 0.0, 0.0, 1.0, 0.0], [1.0, 0.8, 1.0, 0.0, 0.8, 0.6, 0.0, 0.0, 0.8, 1.0], [0.6, 0.8, 0.2, 0.0, 0.0, 0.0, 1.0, 0.8, 0.0, 0.2], [0.2, 0.8, 1.0, 1.0, 0.4, 1.0, 0.0, 0.0, 0.0, 0.0]])

rs_10_sp = np.array([[0.781, 0.768, 0.785, 0.776, 0.7849999999999999, 0.779, 0.776, 0.779, 0.7710000000000001, 0.78], [0.777, 0.772, 0.7849999999999999, 0.776, 0.784, 0.766, 0.795, 0.778, 0.779, 0.7689999999999999], [0.767, 0.773, 0.762, 0.771, 0.78, 0.779, 0.783, 0.774, 0.774, 0.779], [0.783, 0.795, 0.787, 0.7700000000000001, 0.787, 0.7709999999999999, 0.7869999999999999, 0.78, 0.7699999999999999, 0.792], [0.764, 0.7889999999999999, 0.788, 0.7729999999999999, 0.782, 0.7830000000000001, 0.764, 0.7759999999999999, 0.775, 0.7750000000000001]])

rs_10_cm = np.array([[0.0, 0.18, 0.538, 0.0, 1.0219999999999998, 0.5345, 0.0, 0.34750000000000003, 0.0, 0.0215], [0.176, 0.0, 0.861, 0.868, 0.6825, 0.8350000000000002, 0.5029999999999999, 0.0, 0.0, 0.341], [1.704, 1.0394999999999999, 0.3445, 0.0, 0.38649999999999995, 1.0219999999999998, 0.0, 0.014499999999999999, 1.7035, 1.6915], [0.337, 0.8684999999999998, 0.0, 0.0, 0.0, 0.0, 1.7570000000000001, 0.0, 0.0, 0.4995], [0.0, 0.8664999999999999, 1.1444999999999999, 1.7100000000000002, 0.7304999999999999, 1.3495, 0.178, 0.193, 0.0, 0.0]])

def trials_to_95_percent(array):
    # Best performance for the method: max across all runs and trials
    best_perf = np.max(array)

    trials_list = []
    for run in array:
        # Find the first trial (1-based) where performance >= 0.95 * best
        reached = np.where(run >= 0.95 * best_perf)[0]
        if len(reached) > 0:
            trials = reached[0] + 1  # 1-based index
        else:
            trials = len(run)  # If never reached, set to max trials + 1
        trials_list.append(trials)

    return np.array(trials_list)

trials1 = trials_to_95_percent(rs_10_cm)
trials2 = trials_to_95_percent(bo_10_cm)
trials3 = trials_to_95_percent(dqn_10_cm)

# Combine into a list for plotting
data = [trials1, trials2, trials3]

print(trials1)
print(trials2)
print(trials3)

plt.figure(figsize=(12, 8))

# Create the box and whisker plot with whiskers to min/max and custom median
plt.boxplot(
    data,
    labels=['Random search', 'Bayesian optimisation', 'DQN'],
    whis=[0, 100],
    showmeans=True,
    boxprops={'linewidth': 2},
    medianprops={'linewidth': 3, 'color': 'red'},
    meanprops={'marker': '^', 'markerfacecolor': 'green', 'markeredgecolor': 'green', 'markersize': 10},
    whiskerprops={'linewidth': 2}
)
plt.title('Box and Whisker Plot of the trials to 95% of maximum performance for Sepsis/ICU-Sepsis-v2', fontsize=14, pad=15)
plt.ylabel('Trials to 95% of maximum performance', fontsize=12)
plt.xlabel('Methods', fontsize=12)
plt.grid(True, linestyle='--', alpha=0.7)
plt.tight_layout()  # Adjust layout to prevent clipping
plt.show()
