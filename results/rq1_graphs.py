from scipy.stats import bootstrap
import matplotlib.pyplot as plt
from matplotlib.patches import Patch
from scipy.stats import wilcoxon
import pandas as pd
import numpy as np
import seaborn as sns


dqn_10_cm = np.array([
        [1.402, 0.000, 1.744, 1.674, 1.403, 1.722, 1.552, 1.713, 1.683, 1.541],
        [0.342, 0.000, 1.706, 1.687, 1.057, 1.695, 1.734, 1.353, 1.682, 1.391],
        [0.334, 0.000, 1.713, 0.504, 1.200, 1.736, 1.736, 1.739, 1.731, 1.698],
        [1.727, 0.000, 1.695, 1.662, 1.232, 1.679, 1.718, 1.169, 1.419, 1.565],
        [1.219, 1.347, 0.565, 1.183, 1.711, 1.359, 0.000, 1.736, 1.527, 1.537]
    ])

dqn_10_sp = np.array([[0.789, 0.774, 0.78, 0.773, 0.786, 0.763, 0.791, 0.787, 0.775, 0.77], [0.776, 0.767, 0.776, 0.785, 0.777, 0.782, 0.777, 0.777, 0.788, 0.782], [0.773, 0.784, 0.771, 0.774, 0.775, 0.796, 0.776, 0.78, 0.797, 0.78], [0.783, 0.78, 0.778, 0.777, 0.777, 0.782, 0.772, 0.789, 0.797, 0.778], [0.775, 0.782, 0.799, 0.777, 0.787, 0.782, 0.772, 0.798, 0.79, 0.785]])

dqn_10_sm = np.array([[0.4, 0.0, 0.8, 0.2, 0.8, 1.0, 1.0, 1.0, 1.0, 1.0], [0.0, 0.0, 1.0, 1.0, 0.4, 0.8, 1.0, 1.0, 1.0, 0.0], [1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.6, 1.0, 0.6], [1.0, 0.0, 1.0, 1.0, 1.0, 0.4, 1.0, 0.0, 0.6, 0.6], [1.0, 0.0, 0.4, 0.8, 1.0, 0.6, 0.0, 1.0, 0.4, 0.0]])

bo_10_sm = np.array([[0.6, 0.8, 0.6, 0.2, 1.0, 0.8, 0.4, 0.0, 0.0, 0.2], [0.4, 0.0, 0.0, 0.0, 0.6, 0.4, 0.0, 0.0, 0.4, 0.0], [1.0, 0.6, 1.0, 0.0, 0.8, 0.6, 0.0, 0.0, 0.6, 1.0], [0.0, 0.4, 0.0, 0.0, 0.0, 0.0, 1.0, 0.6, 0.0, 0.6], [0.4, 0.6, 1.0, 1.0, 0.0, 0.8, 0.0, 0.0, 0.0, 0.0]])

bo_10_sp = np.array([[0.778, 0.784, 0.779, 0.798, 0.79, 0.776, 0.785, 0.772, 0.7809999999999999, 0.7759999999999999], [0.7699999999999999, 0.772, 0.764, 0.777, 0.768, 0.772, 0.766, 0.77, 0.788, 0.773], [0.783, 0.772, 0.7779999999999999, 0.783, 0.7819999999999999, 0.79, 0.7879999999999999, 0.785, 0.778, 0.79], [0.799, 0.777, 0.7779999999999999, 0.785, 0.768, 0.784, 0.776, 0.776, 0.78, 0.7819999999999998], [0.7889999999999999, 0.792, 0.775, 0.7729999999999999, 0.782, 0.788, 0.7790000000000001, 0.776, 0.773, 0.7769999999999999]])

bo_10_cm = np.array([[0.5980000000000001, 0.9675, 1.0470000000000002, 0.1925, 1.2195, 0.0, 0.018, 0.34049999999999997, 0.0, 0.521], [0.1715, 0.0, 0.8825, 0.513, 0.3225, 0.3675, 0.16899999999999998, 0.0, 0.20800000000000002, 1.0550000000000002], [1.721, 0.8515, 1.396, 1.203, 1.0245, 0.5065, 0.53, 0.3205, 1.5815, 1.722], [0.3435, 0.5305, 0.324, 0.8850000000000001, 0.0, 0.0, 1.0435, 0.525, 0.0, 0.8785000000000001], [1.342, 0.3205, 1.5875000000000001, 1.734, 0.44000000000000006, 1.565, 0.0, 0.6845, 0.0, 0.0]])

rs_10_sm = np.array([[0.6, 0.4, 0.4, 0.2, 0.8, 0.6, 0.0, 0.0, 0.0, 0.0], [0.4, 0.0, 0.0, 0.0, 0.6, 0.8, 0.2, 0.0, 1.0, 0.0], [1.0, 0.8, 1.0, 0.0, 0.8, 0.6, 0.0, 0.0, 0.8, 1.0], [0.4, 0.4, 0.0, 0.0, 0.0, 0.0, 0.8, 0.6, 0.0, 0.4], [0.8, 0.4, 1.0, 1.0, 0.6, 1.0, 0.4, 0.0, 0.0, 0.0]])

rs_10_sp = np.array([[0.7729999999999999, 0.78, 0.778, 0.757, 0.7849999999999999, 0.781, 0.774, 0.7770000000000001, 0.783, 0.777], [0.77, 0.772, 0.771, 0.773, 0.8, 0.792, 0.767, 0.78, 0.78, 0.774], [0.7979999999999999, 0.789, 0.777, 0.777, 0.768, 0.7689999999999999, 0.783, 0.774, 0.7849999999999999, 0.78], [0.776, 0.7819999999999999, 0.7699999999999999, 0.7809999999999999, 0.782, 0.769, 0.779, 0.7770000000000001, 0.774, 0.776], [0.78, 0.775, 0.783, 0.7950000000000002, 0.78, 0.782, 0.7769999999999999, 0.775, 0.776, 0.775]])

rs_10_cm = np.array([[0.47400000000000003, 0.9324999999999999, 0.3785, 0.024, 1.212, 0.696, 0.0, 0.1765, 0.0, 0.0], [0.192, 0.0, 0.9950000000000001, 1.1960000000000002, 0.509, 0.374, 0.363, 0.0, 0.8240000000000001, 0.8425], [1.6789999999999998, 1.2375, 0.7205000000000001, 0.9075, 1.559, 0.37750000000000006, 0.316, 0.8460000000000001, 0.29900000000000004, 1.3705000000000003], [0.3545, 0.357, 0.33199999999999996, 0.0, 0.0, 0.0, 0.8665, 0.3625, 0.0, 0.327], [1.0580000000000003, 0.663, 1.5619999999999998, 1.6949999999999998, 0.6685000000000001, 1.7325, 0.0, 0.5575, 0.0, 0.0]])

def trials_to_95_percent(array):
    # Best performance for the method: max across all runs and trials
    best_perf = np.max(array)

    trials_list = []
    for run in array:
        # Find the first trial (1-based) where performance >= 0.95 * best
        reached = np.where(run >= 0.95 * best_perf)[0]
        if len(reached) > 0:
            trials = reached[0] + 1  # 1-based index
        else:
            trials = len(run)  # If never reached, set to max trials + 1
        trials_list.append(trials)

    return np.array(trials_list)

trials1 = trials_to_95_percent(rs_10_cm)
trials2 = trials_to_95_percent(bo_10_cm)
trials3 = trials_to_95_percent(dqn_10_cm)

# Combine into a list for plotting
data = [trials1, trials2, trials3]

print(trials1)
print(trials2)
print(trials3)

plt.figure(figsize=(12, 8))

# Create the box and whisker plot with whiskers to min/max and custom median
plt.boxplot(
    data,
    labels=['Random search', 'Bayesian optimisation', 'DQN'],
    whis=[0, 100],
    showmeans=True,
    boxprops={'linewidth': 2},
    medianprops={'linewidth': 3, 'color': 'red'},
    meanprops={'marker': '^', 'markerfacecolor': 'green', 'markeredgecolor': 'green', 'markersize': 10},
    whiskerprops={'linewidth': 2}
)
plt.title('Box and Whisker Plot of the trials to 95% of maximum performance for Sepsis/ICU-Sepsis-v2', fontsize=14, pad=15)
plt.ylabel('Trials to 95% of maximum performance', fontsize=12)
plt.xlabel('Methods', fontsize=12)
plt.grid(True, linestyle='--', alpha=0.7)
plt.tight_layout()  # Adjust layout to prevent clipping
plt.show()
